
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>MuShop Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/custom/mushop-58dd62ca.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-21c7ca2f.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-c5541673.js"></script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-734bf5ad.png" class="logo screen" alt="Logo" />
      <img src="images/logo.print-dfe0bcaa.png" class="logo print" alt="Logo.print" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction-test4" class="toc-h1 toc-link" data-title="Introduction Test4">Introduction Test4</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#goals" class="toc-h2 toc-link" data-title="Goals">Goals</a>
                  </li>
                  <li>
                    <a href="#cloud-native" class="toc-h2 toc-link" data-title="Cloud Native">Cloud Native</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#getting-started" class="toc-h1 toc-link" data-title="Getting Started">Getting Started</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#basic-cloud-installation" class="toc-h2 toc-link" data-title="Basic Cloud Installation">Basic Cloud Installation</a>
                  </li>
                  <li>
                    <a href="#cloud-native-installation" class="toc-h2 toc-link" data-title="Cloud Native Installation">Cloud Native Installation</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#cloud-deployment" class="toc-h1 toc-link" data-title="Cloud Deployment">Cloud Deployment</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#prerequisites" class="toc-h2 toc-link" data-title="Prerequisites">Prerequisites</a>
                  </li>
                  <li>
                    <a href="#provision" class="toc-h2 toc-link" data-title="Provision">Provision</a>
                  </li>
                  <li>
                    <a href="#deploy" class="toc-h2 toc-link" data-title="Deploy">Deploy</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#extras" class="toc-h1 toc-link" data-title="Extras">Extras</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#metrics" class="toc-h2 toc-link" data-title="Metrics">Metrics</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#cleanup" class="toc-h1 toc-link" data-title="Cleanup">Cleanup</a>
          </li>
          <li>
            <a href="#wtf-acknowledgements" class="toc-h1 toc-link" data-title="WTF Acknowledgements">WTF Acknowledgements</a>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href="https://github.com/oracle-quickstart/oci-cloudnative">GitHub</a></li>
            <li>Made with <icon>♥</icon> by Oracle A-Team</li>
            <li>© 2019 Oracle</li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction-test4'>Introduction Test4</h1>
<p>MuShop is a microservices demo application <strong>purpose-built</strong> to showcase
interoperable <a href="https://www.oracle.com/cloud/cloud-native/">Cloud Native</a> services on
<a href="https://www.oracle.com/cloud/">Oracle Cloud Infrastructure</a>.</p>

<p>The premise of MuShop is an e-commerce website offering a variety of cat
products. It represents a polyglot microservice application, with <strong>actual use case</strong>
scenarios for many Oracle Cloud Infrastructure services.</p>

<table><thead>
<tr>
<th><img src="images/mushop.home-70eb8af5.png" title="MuShop UI" alt="mushop" /></th>
<th><img src="images/mushop.about-cf3181ef.png" title="MuShop Services" alt="services" /></th>
</tr>
</thead><tbody>
</tbody></table>

<blockquote>
<p>Each microservice in MuShop is designed to highlight its own, or common high-level
subject in Oracle Cloud Infrastructure, while keeping context of the demo application.</p>
</blockquote>
<h2 id='goals'>Goals</h2>
<ul>
<li>Explore <a href="#cloud-native">Cloud Native</a> services offered by Oracle Cloud Infrastructure</li>
<li>Build and deploy microservices with <a href="https://www.oracle.com/cloud/compute/container-engine-kubernetes.html">Container Engine for Kubernetes</a> (OKE)</li>
<li>Experience Oracle Cloud services integrated into a single project</li>
<li>Provide reference implementations and sample code for real-world development</li>
</ul>
<h2 id='cloud-native'>Cloud Native</h2><h3 id='yyy'>yyy</h3>
<p>The MuShop application highlights many topics related to <a href="https://www.oracle.com/cloud/cloud-native/">Cloud Native</a> application
development with Oracle Cloud Infrastructure.</p>

<table><thead>
<tr>
<th>Cloud Service</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="https://www.oracle.com/cloud/compute/container-engine-kubernetes.html">Container Engine for Kubernetes</a></td>
<td>Enterprise-grade Kubernetes on Oracle Cloud</td>
</tr>
<tr>
<td><a href="https://www.oracle.com/cloud/compute/container-registry.html">Container Registry</a></td>
<td>Highly available service to distribute container images</td>
</tr>
<tr>
<td><a href="https://www.oracle.com/cloud/systems-management/resource-manager/">Resource Manager</a></td>
<td>Infrastructure as code with Terraform</td>
</tr>
<tr>
<td><a href="https://www.oracle.com/big-data/streaming/">Streaming</a></td>
<td>Large scale data collection and processing</td>
</tr>
<tr>
<td><a href="https://www.oracle.com/cloud/systems-management/monitoring/">Monitoring</a></td>
<td>Integrated metrics from all resources and services</td>
</tr>
<tr>
<td><a href="https://github.com/oracle/oci-service-broker">Kubernetes Service Broker</a></td>
<td>Provisioning cloud resources within Kubernetes</td>
</tr>
<tr>
<td><em>Others coming soon</em></td>
<td>-</td>
</tr>
<tr>
<td><a href="https://www.oracle.com/cloud-native/events-service/">Events</a></td>
<td>Trigger actions in response to infrastructure changes</td>
</tr>
<tr>
<td><a href="https://www.oracle.com/cloud-native/functions/">Functions</a></td>
<td>Scalable, multitenant serverless functions</td>
</tr>
<tr>
<td><a href="https://www.oracle.com/cloud/systems-management/notifications/">Notifications</a></td>
<td>Broadcast messages to distributed systems</td>
</tr>
<tr>
<td><a href="https://www.oracle.com/cloud/integration/api-platform-cloud/">API Gateway</a></td>
<td>Fully managed gateway for governed HTTP/S interfaces</td>
</tr>
<tr>
<td><a href="https://go.oracle.com/LP=78019?elqCampaignId=179851">Logging</a></td>
<td>Single pane of glass for resources and applications</td>
</tr>
</tbody></table>

<p>In addition to these Cloud Native topics, MuShop demonstrates the use of several
<strong><em>backing services</em></strong>  available on Oracle Cloud Infrastructure.</p>

<ul>
<li><a href="https://www.oracle.com/database/autonomous-transaction-processing.html">Autonomous Transaction Processing Database</a></li>
<li><a href="https://www.oracle.com/cloud/storage/object-storage.html">Object Storage</a></li>
<li><a href="https://www.oracle.com/cloud/security/cloud-services/web-application-firewall.html">Web Application Firewall</a></li>
</ul>

<!-- - [Health Checks](https://www.oracle.com/cloud/networking/health-checks.html) -->

<!-- - [Email Delivery](https://www.oracle.com/cloud/networking/email-delivery.html) -->
<h3 id='mushop-services'>MuShop Services</h3>
<table><thead>
<tr>
<th>Service</th>
<th>Technology</th>
<th>Cloud Services</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>src/api</code></td>
<td>Node.js</td>
<td></td>
<td>Storefront API</td>
</tr>
<tr>
<td><code>src/carts</code></td>
<td>Java</td>
<td>Autonomous DB (ATP)</td>
<td>Shopping cart</td>
</tr>
<tr>
<td><code>src/catalogue</code></td>
<td>Go</td>
<td>Autonomous DB (ATP)</td>
<td>Product catalogue</td>
</tr>
<tr>
<td><code>src/orders</code></td>
<td>Java</td>
<td>Autonomous DB (ATP)</td>
<td>Customer orders</td>
</tr>
<tr>
<td><code>src/payments</code></td>
<td>Go</td>
<td></td>
<td>Payment processing</td>
</tr>
<tr>
<td><code>src/router</code></td>
<td>traefik</td>
<td></td>
<td>Request routing</td>
</tr>
<tr>
<td><code>src/shipping</code></td>
<td>Java</td>
<td>Streaming</td>
<td>Shipping producer</td>
</tr>
<tr>
<td><code>src/stream</code></td>
<td>Java</td>
<td>Streaming</td>
<td>Shipping fulfillment</td>
</tr>
<tr>
<td><code>src/storefront</code></td>
<td>JavaScript</td>
<td></td>
<td>Store UI</td>
</tr>
<tr>
<td><code>src/user</code></td>
<td>TypeScript</td>
<td>Autonomous DB (ATP)</td>
<td>Customer accounts, AuthN</td>
</tr>
</tbody></table>
<h1 id='getting-started'>Getting Started</h1>
<p>This project supports deployment modes for the purposes of demonstrating
different functionality on Oracle Cloud Infrastructure. While the source code
is identical across these options, certain services are omitted in the <code>basic</code>
deployment.</p>

<table><thead>
<tr>
<th><a href="#basic-cloud-installation">Basic: <code>deploy/basic</code></a></th>
<th><a href="#cloud-native-installation">Cloud Native: <code>deploy/complete</code></a></th>
</tr>
</thead><tbody>
<tr>
<td>Simplified runtime utilizing <strong>only</strong> <a href="https://www.oracle.com/cloud/free/">Always Free</a> resources deployed with <a href="https://www.oracle.com/cloud/systems-management/resource-manager/">Resource Manager</a></td>
<td>Full-featured <a href="https://kubernetes.io/">Kubernetes</a> microservices deployment showcasing Oracle <a href="https://www.oracle.com/cloud/cloud-native/">Cloud Native</a> technologies and backing services</td>
</tr>
</tbody></table>

<p>xx</p>
<pre class="highlight plaintext"><code>mushop
└── deploy
    ├── basic
    └── complete
</code></pre>
<blockquote>
<p>Options for different MuShop deployment modes</p>
</blockquote>
<h2 id='basic-cloud-installation'>Basic Cloud Installation</h2>
<p>This deployment is designed to run using <strong>only</strong> Always Free resources.
It uses MuShop source code and the Oracle Cloud Infrastructure
<a href="https://www.terraform.io/docs/providers/oci/index.html">Terraform Provider</a> to
produce a <a href="https://docs.cloud.oracle.com/iaas/Content/ResourceManager/Concepts/resourcemanager.htm">Resource Manager</a> stack,
that <em>provisions</em> all required resources and <em>configures</em> the application on
those resources.</p>
<pre class="highlight shell tab-shell"><code><span class="nb">cd </span>deploy/basic
</code></pre>
<blockquote>
<p>Source directory for basic deployment option</p>
</blockquote>

<p>These steps outline the <strong>Basic</strong> deployment using Resource Manager:</p>

<ol>
<li><p>Download the latest <a href="https://github.com/oracle-quickstart/oci-cloudnative/releases"><code>mushop-basic-stack-v1.x.x.zip</code></a> file.</p></li>
<li><p><a href="https://console.us-ashburn-1.oraclecloud.com/resourcemanager/stacks/create">Login</a> to the console to import the stack.</p>

<blockquote>
<p>Home &gt; Solutions &amp; Platform &gt; Resource Manager &gt; Stacks &gt; Create Stack</p>
</blockquote></li>
<li><p>Upload the <code>mushop-basic-stack-v1.x.x.zip</code> file that was downloaded earlier, and provide a name and description for the stack.</p></li>
<li><p>Specify configuration options:</p>

<ol>
<li><strong>Database Name</strong> - You can choose to provide a database name (optional)</li>
<li><strong>Node Count</strong> - Select if you want to deploy one or two application instances.</li>
<li><strong>Availability Domain</strong>  - Select any availability domain to create the resources. If you run in to service limits, you could try another availability domain.</li>
</ol></li>
<li><p>Review the information and click <code>Create</code> button.</p>

<blockquote>
<p>The upload can take a few seconds, after which you will be taken to the newly created stack</p>
</blockquote></li>
<li><p>On Stack details page, select <code>Terraform Actions &gt; Apply</code></p></li>
</ol>

<aside class="notice">
  The application is deployed to the compute instances <strong>asynchronously</strong>,
  and it may take a few minutes for the public URL to serve the application.
</aside>
<h2 id='cloud-native-installation'>Cloud Native Installation</h2>
<p>This deployment option utilizes <a href="https://github.com/helm/helm"><code>helm</code></a> for
configuration and installation onto a <a href="https://kubernetes.io/">Kubernetes</a>
cluster. It is <em>recommended</em> to use an
<a href="https://docs.cloud.oracle.com/iaas/Content/ContEng/Concepts/contengoverview.htm">Oracle Container Engine for Kubernetes</a>
cluster, however other <strong>standard</strong> Kubernetes clusters will also work.</p>
<pre class="highlight plaintext"><code>cd deploy/complete/helm-chart
</code></pre>
<blockquote>
<p>Path for Cloud Native deployment configurations using <code>helm</code></p>
</blockquote>

<p>Deploying the complete MuShop application with backing services from Oracle Cloud
Infrastructure involves the use of the following helm charts:</p>

<ol>
<li><a href="#setup"><code>setup</code></a>: Installs umbrella chart dependencies on the cluster <em>(optional)</em></li>
<li><a href="#provision"><code>provision</code></a>: Provisions OCI resources integrated with Service Broker <em>(optional)</em></li>
<li><a href="#installation"><code>mushop</code></a>: Deploys the MuShop application runtime</li>
</ol>

<hr>
<h3 id='setup'>Setup</h3>
<p>MuShop provides an umbrella helm chart called <code>setup</code>, which includes several
<em>recommended</em> installations on the cluster. These represent common 3rd party
services, which integrate with Oracle Cloud Infrastructure or enable certain
application features.</p>

<table><thead>
<tr>
<th>Chart</th>
<th>Purpose</th>
<th>Option</th>
</tr>
</thead><tbody>
<tr>
<td><a href="https://github.com/helm/charts/blob/master/stable/prometheus/README.md">Prometheus</a></td>
<td>Service metrics aggregation</td>
<td><code>prometheus.enabled</code></td>
</tr>
<tr>
<td><a href="https://github.com/helm/charts/blob/master/stable/grafana/README.md">Grafana</a></td>
<td>Infrastructure/service visualization dashboards</td>
<td><code>grafana.enabled</code></td>
</tr>
<tr>
<td><a href="https://github.com/helm/charts/blob/master/stable/metrics-server/README.md">Metrics Server</a></td>
<td>Support for Horizontal Pod Autoscaling</td>
<td><code>metrics-server.enabled</code></td>
</tr>
<tr>
<td><a href="https://github.com/helm/charts/blob/master/stable/nginx-ingress/README.md">Nginx Ingress</a></td>
<td>Ingress controller and public Load Balancer</td>
<td><code>nginx-ingress.enabled</code></td>
</tr>
<tr>
<td><a href="https://github.com/kubernetes-sigs/service-catalog/blob/master/charts/catalog/README.md">Service Catalog</a></td>
<td>Service Catalog chart utilized by Oracle Service Broker</td>
<td><code>catalog.enabled</code></td>
</tr>
</tbody></table>

<blockquote>
<p>Dependencies installed with <code>setup</code> chart. <strong>NOTE</strong> as these are very common installations, each may be disabled as needed to resolve conflicts.</p>
</blockquote>

<p>From <code>deploy/complete/helm-chart</code> directory:</p>

<ol>
<li><p>Add required helm repositories:</p>
<pre class="highlight shell tab-shell"><code>helm repo add svc-cat https://svc-catalog-charts.storage.googleapis.com
helm repo add stable https://kubernetes-charts.storage.googleapis.com
</code></pre></li>
<li><p>Install chart dependencies:</p>
<pre class="highlight shell tab-shell"><code>helm dependency update setup
</code></pre></li>
<li><p>Install <code>setup</code> chart:</p>
<pre class="highlight shell tab-shell"><code>helm install setup <span class="se">\</span>
  --name mushop-setup <span class="se">\</span>
  --namespace mushop-setup
</code></pre></li>
<li><p><strong>NOTE</strong> the public <code>EXTERNAL-IP</code> assigned to the ingress controller load balancer:</p>
<pre class="highlight shell tab-shell"><code>kubectl get svc mushop-setup-nginx-ingress-controller <span class="se">\</span>
  --namespace mushop-setup
</code></pre></li>
</ol>
<h3 id='deploy-mushop'>Deploy MuShop</h3>
<p>To get started with the simplest installation, MuShop supports a <em>mock mode</em>
deployment option where cloud backing services are disconnected or <strong>mocked</strong>,
yet the application remains fully functional. This is useful for development,
testing, and cases where cloud connectivity is not available.</p>

<p>From <code>deploy/complete/helm-chart</code> directory:</p>

<ol>
<li><p>Deploy &quot;mock mode&quot; with <code>helm</code>:</p>
<pre class="highlight shell tab-shell"><code>helm install mushop <span class="se">\</span>
  --name mushop <span class="se">\</span>
  --set global.mock.service<span class="o">=</span><span class="s2">"all"</span>
</code></pre></li>
<li><p>Wait for services to be <em>Ready</em>:</p>
<pre class="highlight shell tab-shell"><code>kubectl get pod --watch
</code></pre></li>
<li><p>Open a browser with the <code>EXTERNAL-IP</code> created during setup, <strong>OR</strong> <code>port-forward</code>
directly to the <code>edge</code> service resource:</p>
<pre class="highlight shell tab-shell"><code>kubectl port-forward <span class="se">\</span>
  svc/edge 8000:80
</code></pre>
<blockquote>
<p>Using <code>port-forward</code> connecting <a href="http://localhost:8000">localhost:8000</a> to the <code>edge</code> service</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>kubectl get svc mushop-setup-nginx-ingress-controller <span class="se">\</span>
  --namespace mushop-setup
</code></pre>
<blockquote>
<p>Locating <code>EXTERNAL-IP</code> for Ingress Controller. <strong>NOTE</strong> this will be
<a href="https://localhost">localhost</a> on local clusters.</p>
</blockquote></li>
</ol>

<aside class="warning">
  It may take a few moments to download all the application images.
  It is also normal for some pods to show errors in mock mode.
</aside>
<h1 id='cloud-deployment'>Cloud Deployment</h1><h2 id='prerequisites'>Prerequisites</h2>
<p>In order connect the MuShop application with services in Oracle Cloud Infrastructure,
several configurations are necessary. These tenancy configurations will be used to
properly provision and/or connect cloud services: Create a file with the following
information to simplify lookups later:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">region</span><span class="pi">:</span>       <span class="c1"># Region where resources will be provisioned. (ex: us-phoenix-1)</span>
<span class="na">tenancy</span><span class="pi">:</span>      <span class="c1"># Tenancy OCID value</span>
<span class="na">user</span><span class="pi">:</span>         <span class="c1"># API User OCID value</span>
<span class="na">compartment</span><span class="pi">:</span>  <span class="c1"># Compartment OCID value</span>
<span class="na">key</span><span class="pi">:</span>          <span class="c1"># Private API Key file path (ex: /Users/jdoe/.oci/oci_key.pem)</span>
<span class="na">fingerprint</span><span class="pi">:</span>  <span class="c1"># Public API Key fingerprint (ex: 43:65:2c...)</span>
</code></pre><h3 id='compartment'>Compartment</h3>
<p>Depending on the tenancy and your level of access, you may want (or need) to
create a Compartment dedicated to this application and the resources allocated.</p>

<ol>
<li><p>Open Console and navigate to Compartments</p>

<blockquote>
<p>Governance and Admininstration » Identity » Compartments » <code>Create Compartment</code></p>
</blockquote></li>
<li><p>Specify metadata for the Compartment, and make note of the <strong>OCID</strong></p></li>
</ol>
<h3 id='api-user'>API User</h3>
<p>You will need a User with API Key access in your tenancy.
This can be your personal user account, or a virtual user specific to usage of
this application.</p>

<ol>
<li><p>Open Console and navigate to Users</p>

<blockquote>
<p>Governance and Admininstration » Identity » Users</p>
</blockquote></li>
<li><p>Select <em>or create</em> the user you wish to use</p></li>
<li><p>If necessary, follow these <a href="https://docs.cloud.oracle.com/iaas/Content/Functions/Tasks/functionssetupapikey.htm">instructions</a> to create an API key</p></li>
<li><p>Make note of the following items:</p>

<ul>
<li>User <strong>OCID</strong></li>
<li>API Key <strong>Fingerprint</strong></li>
</ul></li>
</ol>
<h3 id='user-policies'>User Policies</h3>
<p>If your configured User (with API Key) is <strong>not</strong> a member of the Administrators Group,
then a Group with specific Policies must be created, and the User added as a member.</p>

<ol>
<li><p>Open Console and navigate to Groups</p>

<blockquote>
<p>Governance and Admininstration » Identity » Groups » <code>Create Group</code></p>
</blockquote></li>
<li><p>Specify metadata for the Group, and make note of the <strong>NAME</strong></p></li>
<li><p>Click the <code>Add User to Group</code> button and select your API User</p></li>
<li><p>Create a Policy with the folliwing statement:</p>

<blockquote>
<p>Governance and Admininstration » Identity » Policies » <code>Create Policy</code></p>
</blockquote>
<pre class="highlight plaintext"><code>Allow group &lt;GroupName&gt; to manage all-resources in compartment &lt;CompartmentName&gt;
</code></pre></li>
</ol>

<aside class="warning">
   This policy is intentionally broad for the sake of simplicity,
   and is **not** recommended in most real-world use cases.
   Refer to the <a href="https://docs.cloud.oracle.com/iaas/Content/Identity/Concepts/overview.htm#three">Documentation</a>
   for more on this topic.
</aside>
<h3 id='service-limits'>Service Limits</h3>
<p>Deploying the full application requires services from Oracle Cloud
Infrastructure. Use of these services will be subject to Service Limits in your
tenancy. Check minimum resource availability as follows:</p>

<blockquote>
<p>Check limits in the Console: Governance and Admininstration » Governance » Limits, Quotas, and Usage</p>
</blockquote>

<table><thead>
<tr>
<th>Service</th>
<th>Resource</th>
<th>Requirement</th>
</tr>
</thead><tbody>
<tr>
<td>Autonomous Transaction Processing Database</td>
<td>OCPU Count</td>
<td><code>&gt;=1</code></td>
</tr>
<tr>
<td>Streaming</td>
<td>Partition Count</td>
<td><code>&gt;=1</code></td>
</tr>
</tbody></table>

<aside class="notice">
  This does not include requirements in cases where OKE is used.
</aside>
<h2 id='provision'>Provision</h2>
<p>The included <code>provision</code> chart is an application of the open-source <a href="https://github.com/oracle/oci-service-broker">OCI Service Broker</a>
for <em>provisioning</em> Oracle Cloud Infrastructure services. This implementation utilizes <a href="https://github.com/openservicebrokerapi/servicebroker/blob/v2.14/spec.md">Open Service Broker</a> in Oracle Container Engine for Kubernetes or in other Kubernetes clusters.</p>
<pre class="highlight plaintext"><code>cd deploy/complete/helm-chart
</code></pre>
<ol>
<li><p>The Service Broker for Kubernetes requires tenancy credentials to provision and
manage services from within the cluster. Create a secret containing these
values:</p>
<pre class="highlight shell tab-shell"><code>kubectl create secret generic oci-service-broker <span class="se">\</span>
  --namespace mushop <span class="se">\</span>
  --from-literal<span class="o">=</span><span class="nv">tenancy</span><span class="o">=</span>&lt;TENANCY_OCID&gt; <span class="se">\</span>
  --from-literal<span class="o">=</span><span class="nv">user</span><span class="o">=</span>&lt;USER_OCID&gt; <span class="se">\</span>
  --from-literal<span class="o">=</span><span class="nv">region</span><span class="o">=</span>&lt;USER_OCI_REGION&gt; <span class="se">\</span>
  --from-literal<span class="o">=</span><span class="nv">fingerprint</span><span class="o">=</span>&lt;PUBLIC_API_KEY_FINGERPRINT&gt; <span class="se">\</span>
  --from-literal<span class="o">=</span><span class="nv">passphrase</span><span class="o">=</span>&lt;PRIVATE_API_KEY_PASSPHRASE&gt; <span class="se">\</span>
  --from-file<span class="o">=</span><span class="nv">privatekey</span><span class="o">=</span>&lt;PATH_OF_PRIVATE_API_KEY&gt;
</code></pre></li>
<li><p>Deploy the OCI service broker on your cluster. This is done with the <a href="https://github.com/oracle/oci-service-broker">Oracle OCI Service Broker</a> helm chart:</p>
<pre class="highlight shell tab-shell"><code>helm install https://github.com/oracle/oci-service-broker/releases/download/v1.3.1/oci-service-broker-1.3.1.tgz <span class="se">\</span>
  --namespace mushop <span class="se">\</span>
  --name oci-service-broker <span class="se">\</span>
  --set ociCredentials.secretName<span class="o">=</span>oci-service-broker <span class="se">\</span>
  --set storage.etcd.useEmbedded<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  --set tls.enabled<span class="o">=</span><span class="nb">false</span>
</code></pre>
<blockquote>
<p>The above command will deploy the OCI Service Broker using an embedded etcd instance. It is not recommended to deploy the OCI Service Broker using an embedded etcd instance and tls disabled in production environments, instead a separate etcd cluster should be setup and used by the OCI Service Broker.</p>
</blockquote></li>
<li><p>Now establish the link between Service Catalog and the OCI Service Broker implementation by installing the <code>provision</code> chart:</p>
<pre class="highlight shell tab-shell"><code>helm install provision <span class="se">\</span>
  --namespace mushop <span class="se">\</span>
  --name mushop-provision <span class="se">\</span>
  --set skip.ociCredentials<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  --set global.osb.compartmentId<span class="o">=</span>&lt;compartmentId&gt;
</code></pre>
<blockquote>
<p>Note that <code>ociCredentials</code> were created previously</p>
</blockquote></li>
<li><p>Verify <code>serviceinstances</code> and <code>servicebindings</code> are <strong>READY</strong></p>
<pre class="highlight plaintext"><code>kubectl get serviceinstances -A
</code></pre><pre class="highlight plaintext"><code>kubectl get servicebindings -A
</code></pre></li>
</ol>
<h2 id='deploy'>Deploy</h2>
<p>Having completed the <a href="#provision">Provisioning</a> steps above, the <code>mushop</code> deployment
helm chart is used with settings to leverage cloud backing services and their resulting
<code>servicebindings</code> with connection information</p>
<pre class="highlight shell tab-shell"><code>helm install mushop <span class="se">\</span>
  --namespace mushop <span class="se">\</span>
  --name mushop <span class="se">\</span>
  --set global.osb.atp<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  --set skip.streaming<span class="o">=</span><span class="nb">true</span>
</code></pre>
<aside class="notice">
  The above command includes <code>--skip.streaming=true</code> indicating that the Streaming
  configurations should be excluded. Refer to details in <a href="https://github.com/oracle-quickstart/oci-cloudnative/blob/master/deploy/complete/helm-chart/mushop/values.yaml">values.yaml</a> for information on connecting to the Streaming service
</aside>
<h1 id='extras'>Extras</h1><h2 id='metrics'>Metrics</h2>
<p>Prometheus and Grafana are installed part of the <a href="#setup"><code>setup</code></a> umbrella helm chart.
Revisit the application charts and connect to some Grafana dashboards:</p>

<ol>
<li><p>List helm releases:</p>
<pre class="highlight plaintext"><code>helm list
</code></pre><pre class="highlight plaintext"><code>NAME          REVISION        UPDATED                         STATUS          CHART                   APP VERSION     NAMESPACE
mushop-setup  1               Tue Nov 12 06:12:45 2019        DEPLOYED        mushop-setup-0.0.1      1.0             mushop-setup
mushop        1               Wed Nov 13 20:23:28 2019        DEPLOYED        mushop-0.1.0            1.0             mushop
</code></pre></li>
<li><p>Get the Grafana outputs from the <code>mushop-setup</code> installation:</p>
<pre class="highlight plaintext"><code>helm status mushop-setup

## Grafana...
</code></pre></li>
<li><p>Get the auto-generated Grafana <code>admin</code> password:</p>
<pre class="highlight plaintext"><code>kubectl get secret -n mushop-setup mushop-setup-grafana \
  -o jsonpath="{.data.admin-password}" | base64 --decode ; echo
</code></pre></li>
<li><p>Connect to the <a href="http://localhost:3000">dashboard</a> with <code>admin</code>/<code>&lt;password&gt;</code>:</p>
<pre class="highlight plaintext"><code>kubectl port-forward -n mushop-setup \
  svc/mushop-setup-grafana 3000:80
</code></pre></li>
<li><p>Import <a href="https://grafana.com/grafana/dashboards">dashboards</a> from Grafana:</p>

<ul>
<li><a href="https://grafana.com/grafana/dashboards/6417">Kubernetes Cluster</a></li>
<li><a href="https://grafana.com/grafana/dashboards/6336">Kubernetes Pods</a></li>
</ul>

<blockquote>
<p>Many community dashboards exist, those above are some basic recommendations</p>
</blockquote></li>
</ol>
<h1 id='cleanup'>Cleanup</h1>
<p>The following list represents cleanup operations, which may vary
depending on the actions performed for setup and deployment of MuShop.</p>

<ul>
<li><p>List any <code>helm</code> releases that may have been installed:</p>
<pre class="highlight plaintext"><code>helm list
</code></pre><pre class="highlight plaintext"><code>NAME          REVISION        UPDATED                         STATUS          CHART                   APP VERSION     NAMESPACE
mushop-setup  1               Tue Nov 12 06:12:45 2019        DEPLOYED        mushop-setup-0.0.1      1.0             mushop-setup
mushop        1               Wed Nov 13 20:23:28 2019        DEPLOYED        mushop-0.1.0            1.0             mushop
</code></pre></li>
<li><p>Remove the application from Kubernetes where <code>--name mushop</code> was used during install:</p>
<pre class="highlight shell tab-shell"><code>helm delete --purge mushop
</code></pre></li>
<li><p>Remove the <code>setup</code> cluster dependency installation:</p>
<pre class="highlight shell tab-shell"><code>helm delete --purge mushop-setup
</code></pre></li>
</ul>
<h1 id='wtf-acknowledgements'>WTF Acknowledgements</h1>
<p>This project, and its associative materials utilizes many excellent projects from
the open source community. While there are numerous, the following projects deserve
some special recognition:</p>

<ul>
<li><a href="https://microservices-demo.github.io/">Sock Shop</a>: Comprehensive microservices demo from Weaveworks</li>
<li><a href="https://github.com/slatedocs/slate">Slate</a>: Tool used to create this documentation</li>
<li><a href="https://revealjs.com/">Reveal.js</a>: HTML presentation tool used to develop workshop materials</li>
<li><a href="https://github.com/chekromul/uikit-ecommerce-template">Roman Chekurov</a>: Inspiration and basis for MuShop UI</li>
</ul>

      </div>
      <div class="dark-box redwood-bar">
      </div>
      <div class="footer-wrapper">
      </div>
    </div>
  </body>
</html>
